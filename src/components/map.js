import { useContext, useRef, useState } from 'react'
import ReactMapGL, { FlyToInterpolator, Marker } from 'react-map-gl'
import mcData from '../data/mcdonalds.json'
import replaceComma from '../filters/replaceComma'
import useSupercluster from 'use-supercluster'
import 'mapbox-gl/dist/mapbox-gl.css'
import './map.css'
import MapInfo from './mapInfo'
import { YearContext } from './provider'

export default function Map() {
    const [viewport, setViewport] = useState({
        latitude: 52.21483,
        longitude: 6.300000,
        width: '100vw',
        height: '40em',
        zoom: 6.8,
        pitch: 0,
        bearing: 0
    })
    const [showInfo, setShowInfo] = useState(true)
    const mapRef = useRef()

    let lastId = 0
    const {selectedYear} = useContext(YearContext)

    const data = mcData
    const trash = data ? data : []

    const filteredData = trash.filter(d => d.Jaar === parseInt(selectedYear))
    
    const points = filteredData.map(data => ({
      type: "Feature",
      properties: { cluster: false, trashId: lastId++, category: data.Category },
      geometry: {
        type: "Point",
        coordinates: [
          parseFloat(replaceComma(data.lon)),
          parseFloat(replaceComma(data.lat))
        ]
      }
    }))

    let plastic = []

    for (let i=0; i<filteredData.length; i++) {
      if (filteredData[i].Material.toLowerCase() === 'aluminum') {
        plastic++
      }
    }

    console.log(plastic)

    const bounds = mapRef.current ? mapRef.current.getMap().getBounds().toArray().flat() : null

    const { clusters, supercluster } = useSupercluster({
      points,
      bounds,
      zoom: viewport.zoom,
      options: { radius: 50, maxZoom: 16}
    })

    const hideInfo = () => {
      viewport.zoom > 6.8 ? setShowInfo(false) : setShowInfo(true)
    }

    return (
        <>
        <h1>Projecten van Dirk</h1>
          <ReactMapGL
            {...viewport}
            maxZoom={20}
            mapStyle="mapbox://styles/jody569/ckybfetie0pg114mjsu44f3l6"
            mapboxApiAccessToken='pk.eyJ1Ijoiam9keTU2OSIsImEiOiJja3g3amJ5MGowMW8wMm5zZTlwN3Fjb2t0In0.99DjUaNvteP2DPXThnnHXg'
            onViewportChange={newviewport => {
              setViewport({ ...newviewport })
            }}
            onWheel={hideInfo}
            ref={mapRef}
          >
            {clusters.map(cluster => {
              const [longitude, latitude] = cluster.geometry.coordinates
              const {
                cluster: isCluster,
                point_count: pointCount
              } = cluster.properties

              if (isCluster) {
                return (
                  <Marker
                    key={`cluster-${cluster.id}`}
                    latitude={latitude}
                    longitude={longitude}
                    offsetTop={-25}
                    offsetLeft={-10}
                  >
                    {pointCount >= 2000 ? 
                      <svg
                       xmlns="http://www.w3.org/2000/svg" 
                       viewBox="0 0 257.921 173.976"
                       style={{
                        width: `${80 + (pointCount / points.length) * 20}px`,
                        height: `${80 + (pointCount / points.length) * 20}px`,
                      }}
                      onClick={() => {
                        const expansionZoom = Math.min(
                          supercluster.getClusterExpansionZoom(cluster.id),
                          30
                        )
  
                        setShowInfo(false)
  
                        setViewport({
                          ...viewport,
                          latitude,
                          longitude,
                          zoom: expansionZoom,
                          transitionInterpolator: new FlyToInterpolator({
                            speed: 1
                          }),
                          transitionDuration: "auto"
                        })
                      }}
                       >
                      <g id="afval_3" transform="translate(-9.421 -5.268)">
                        <path id="Path_8" data-name="Path 8" d="M12.65,134.56c8.7-15.35,22.68-27.92,41.33-31.78.58-1-5.57,0-7-1.28-9.78-6.65,9.58-8.28,11.65-3.13C59.94,93.48,64,88.06,69.84,88.8,80,96,53.21,103.57,70.49,107c2.68,0,5.91,1.58,8.51,3,11,6,28,53.57-4.31,46.86C56,149.71-5.21,173.45,12.65,134.56Z" fill="#29abe2"/>
                        <path id="Path_9" data-name="Path 9" d="M68.51,103.2,73.07,99A27.93,27.93,0,0,0,77,94.91c1.67-2.33,2.06-5.59-.41-7.55-2.75-2.2-7-.84-9.53,1-3,2.15-4.36,5.29-5.54,8.64l2.74-.35c-1.5-2.47-4.56-3.25-7.26-3.59s-6.41-.55-8.64,1.39-1.34,5,.79,6.57c2.69,2,6.5,2,9.72,1.9l-.76-2.8c-1.08.8-2.9.88-4.2,1.26-1.84.53-3.65,1.14-5.43,1.85a62,62,0,0,0-9.67,4.85,63.64,63.64,0,0,0-16.54,15,89.779,89.779,0,0,0-6.17,9.06c-2,3.34-4,6.89-4.47,10.8a12.3,12.3,0,0,0,2.2,9,15.43,15.43,0,0,0,8.77,5.45c8.23,2.15,16.88.79,25.15-.36a113.44,113.44,0,0,1,12.75-1.24,84.229,84.229,0,0,1,12.89.74c4.15.55,8.29,1.73,12.48,1.89a15.11,15.11,0,0,0,10-3.18c5.94-4.68,7.2-12.67,6.86-19.8a24.19,24.19,0,0,0-3.18-11.32,45.64,45.64,0,0,0-7.37-9,73.919,73.919,0,0,0-8.74-7.35c-3.07-2.23-6.37-4.56-10-5.85a11.7,11.7,0,0,0-5.83-.55c-1.9.3-1.1,3.19.79,2.89,3.72-.58,7.29,2,10.24,3.86a72.392,72.392,0,0,1,8.64,6.55c5.23,4.63,10.7,10.23,12,17.33a32.65,32.65,0,0,1,.12,10.44,17,17,0,0,1-4,9.14,11.85,11.85,0,0,1-8.23,3.86c-3.89.15-7.76-1-11.58-1.57a87,87,0,0,0-23.3-.43c-7.71.92-15.45,2.53-23.25,2-6.08-.43-14-2.56-14.6-9.85-.28-3.57,1.38-7,3.08-10a86.868,86.868,0,0,1,5.48-8.5A61.87,61.87,0,0,1,39.49,111.2,58,58,0,0,1,49.68,106a55.942,55.942,0,0,1,5.66-1.87c1.43-.4,3.08-.5,4.29-1.39a1.494,1.494,0,0,0-.75-2.79c-2.25,0-4.67.15-6.8-.67-1.28-.5-3.12-2-1.11-2.91,1.74-.74,4-.55,5.84-.3,1.62.21,3.93.61,4.85,2.14a1.52,1.52,0,0,0,2.74-.36c.84-2.4,1.78-4.77,3.74-6.49,1.44-1.27,5.12-3.27,6.8-1.43,1.51,1.65-.91,4-2,5.1-2.11,2.09-4.36,4.06-6.54,6.08-1.42,1.31.7,3.43,2.12,2.12Z" fill="#1a1a1a"/>
                        <path id="Path_10" data-name="Path 10" d="M119,32.24c5.71-3,19.68-12.46,12.84-20.35-6.08-7-18.1,3.5-20.65,9.2-1.42-4.21-3.75-8.7-7.16-11.63-2.54-2.17-8.7-4.54-9.74.35-.87,4.07,2.46,9.57,4.53,12.8,1.91,3,4.81,8.5,8.46,9.52l-.87,1A204.46,204.46,0,0,0,76.8,114.61c-1.27,9.43-1.86,19.16.62,28.35,1.21,4.52,3.26,9,6.78,12a23.31,23.31,0,0,0,7.8,4.31A40.85,40.85,0,0,0,111.86,161c13.08-2.11,25-10.56,38.21-10.23,2.65.06,5.31.48,7.93.11,4.4-.62,8.22-3.4,11.27-6.63,9.55-10.11,13-25,11.46-38.78s-7.48-26.8-14.67-38.71c-5.13-8.5-11-16.69-18.63-23.05s-17.17-10.78-27.1-10.85" fill="#29abe2"/>
                        <path id="Path_11" data-name="Path 11" d="M125.8,33.32A46.21,46.21,0,0,0,135,27c2.85-2.54,5.75-5.85,6.18-9.79a8.7,8.7,0,0,0-5.64-8.88c-3.67-1.3-7.75.39-10.81,2.4-3.49,2.3-7,5.58-8.78,9.43l2.74.36c-1.5-4.36-3.67-8.72-7.1-11.89-2.16-2-5.36-3.65-8.38-3.32-4,.43-4.91,4.51-4.28,7.9.76,4,3.15,7.53,5.25,11s4.56,7.94,8.76,9.24l-.67-2.5a46.421,46.421,0,0,0-3.88,5.89c-1.58,2.66-3.1,5.37-4.56,8.1q-4.42,8.3-8.08,17a205.908,205.908,0,0,0-11.44,36q-2,9.12-3.14,18.4a80.89,80.89,0,0,0-.4,20.09c.74,5.86,2.28,12,5.92,16.74s9.57,7.35,15.44,8.67a43.2,43.2,0,0,0,19.1-.09C127,160.35,132.46,158,138,156s11.35-3.93,17.34-3.94c3.2,0,6.38.56,9.57,0a18.14,18.14,0,0,0,7.6-3.46c9-6.71,14.06-18,15.59-28.92,1.68-12-.67-24.12-5.19-35.3a128.55,128.55,0,0,0-18.74-32.06c-7.47-9.29-17.29-17.21-29.07-20.07a38.91,38.91,0,0,0-8.66-1.1,1.5,1.5,0,1,0,0,3c24.41.33,40.37,23.92,50.14,43.48,5.23,10.46,9.06,22,9.1,33.75,0,10.59-2.93,21.6-9.8,29.84-3.47,4.15-8,7.95-13.63,8.1-3.07.08-6.11-.41-9.19-.18a43.47,43.47,0,0,0-8.31,1.47c-11.11,3-21.37,9.17-33.16,9.2A35.87,35.87,0,0,1,94.2,155.7c-5-2.85-7.76-7.9-9.23-13.35-3.25-12.06-1.31-25.11.92-37.18A203.371,203.371,0,0,1,111,38.26,40,40,0,0,1,114.39,33a1.53,1.53,0,0,0-.67-2.51c-2.82-.88-4.66-4.16-6.12-6.51a60.27,60.27,0,0,1-4.8-8.4c-.68-1.63-2.41-6.4.25-7.23,1.92-.6,4.53.8,6,2,3.34,2.76,5.4,7,6.78,11,.37,1.1,2.16,1.62,2.74.36a20.78,20.78,0,0,1,6-7.16c2.38-1.9,5.68-4,8.87-3.6a5.62,5.62,0,0,1,4.76,5.93c-.31,3.14-2.9,5.82-5.11,7.83a42.9,42.9,0,0,1-8.82,6.09c-1.7.91-.19,3.5,1.52,2.59Z" fill="#1a1a1a"/>
                        <path id="Path_12" data-name="Path 12" d="M240.2,117.54c-4.29-10.16-9.53-20-16.72-28.42s-16.42-15.22-27-18.33l-.59-.6c2.74.06,5.64.08,8-1.29s3.86-4.67,2.33-7c-1.3-1.94-4-2.25-6.36-2.1-3.32.21-7.1,1.36-8.31,4.46a36.319,36.319,0,0,0-2.69-8A12.12,12.12,0,0,0,183,50.55a5,5,0,0,0-3.31-.33c-2.55.77-3.32,4.15-2.62,6.72s2.47,5,4.17,7.15q2.79,3.57,5.57,7.16l-.66.94a5.75,5.75,0,0,0-2.14-.14,3.93,3.93,0,0,1-.43,1.88,3.86,3.86,0,0,1-1,1.61,3.78,3.78,0,0,1-1.61,1A3.74,3.74,0,0,1,179,77h-.46l-.5.11a5.36,5.36,0,0,1-1.4.68c.7-.22-1.08,1.89-1.37,2.28-1.06,1.39-2.17,2.73-3.33,4-2.38,2.68-4.9,5.23-7.27,7.93a4.18,4.18,0,0,1-4.16,1.53c-.71,1-1.4,2-2.06,3.11a48.53,48.53,0,0,0-5.73,12A51.889,51.889,0,0,0,151,123.91c.05,6.75.76,13.68,3.9,19.66,1.92,3.67,5,7,9,8,3.51.82,7.14-.29,10.63-1.19a67.34,67.34,0,0,1,22.14-2.26c11.62.94,23.28,5.74,34.62,3a18.25,18.25,0,0,0,7.29-3.38c4.2-3.43,6-9.16,5.81-14.58S242.31,122.54,240.2,117.54Z" fill="#29abe2"/>
                        <path id="Path_13" data-name="Path 13" d="M192.8,68.79c-2.38-3.05-4.88-6-7.1-9.21-1.56-2.22-3.42-5.42-2-8.15,1.69-3.17,5.91.25,7.32,2,2.25,2.82,3.12,6.45,4,9.88.29,1.14,2.22,1.58,2.74.36.9-2.12,2.91-3,5.05-3.46,1.92-.4,4.72-.71,6.42.51s.88,3.82-.55,5c-2.1,1.78-5.34,1.58-7.9,1.53a1.51,1.51,0,0,0-1.06,2.56,3.89,3.89,0,0,0,1.07.91,28.18,28.18,0,0,0,2.86.95,48.618,48.618,0,0,1,5.54,2.42,56.08,56.08,0,0,1,10.09,6.69,75.73,75.73,0,0,1,16.25,19.48,123.663,123.663,0,0,1,6.14,11.75,85.319,85.319,0,0,1,5,12.82c2.09,7.56,1.63,17.32-6,21.61-8,4.49-18.22,2.28-26.71.64a101.432,101.432,0,0,0-13.76-2,64.88,64.88,0,0,0-14.12.92q-3.52.6-7,1.49a34.08,34.08,0,0,1-7,1.41c-4.2.18-7.55-2.16-9.82-5.55-4.89-7.3-5.18-17.05-4.77-25.54a40.73,40.73,0,0,1,2.78-13.53,61.87,61.87,0,0,1,6.55-11.52A87.078,87.078,0,0,1,175,82.7a60.56,60.56,0,0,1,9.67-8.7c1.77-1.2,3.82-2.22,6-1.74,1.88.43,2.69-2.47.8-2.89-4.79-1.07-8.8,2.17-12.19,5.12a90,90,0,0,0-9.7,9.82c-6,7-11.67,15.29-13.86,24.38a58.751,58.751,0,0,0-1.31,14.73,51.84,51.84,0,0,0,1.83,13.91c1.22,4.13,3.24,8.29,6.51,11.2,3.58,3.18,7.89,3.9,12.52,3,2.49-.47,4.92-1.23,7.39-1.78a72.122,72.122,0,0,1,7.57-1.3,58.86,58.86,0,0,1,15.12.18c9.7,1.41,19.4,4.58,29.28,3,4.42-.72,8.89-2.5,11.82-6a19.87,19.87,0,0,0,4.32-11.14c.42-4.72-.73-9.49-2.31-13.91a125.86,125.86,0,0,0-5.69-13.18C234.88,91.25,223.08,76.19,206,69.39c-1-.4-2-.76-3-1.09l-.77-.24s.41.34.18.17a3.939,3.939,0,0,1-.49-.51l-1.06,2.57c3.56.07,7.73,0,10.38-2.76,2.19-2.28,3-6.08.63-8.55s-6.1-2.28-9.1-1.79-6.25,2-7.52,5l2.74.36c-1.09-4.31-2.33-8.79-5.53-12.06-2.6-2.65-7.55-5-10.53-1.57-2.62,3-1.67,7.33.1,10.46a48.389,48.389,0,0,0,4,5.54l4.69,6c1.19,1.52,3.3-.62,2.13-2.12Z" fill="#1a1a1a"/>
                        <path id="Path_14" data-name="Path 14" d="M160.7,104.58c-6.09-1.35-12,2.9-16.29,7.39a79.11,79.11,0,0,0-20.47,39.37c-.92,4.72-1.39,9.71.22,14.24a11,11,0,0,0,2.89,4.58c2.16,1.93,5.15,2.57,8,3.14l13.23,2.7c5.69,1.14,11.43,2.28,17.23,2.22,5.56-.07,11-1.25,16.48-2.44,4.14-.91,8.36-1.87,12-4.09a22.86,22.86,0,0,0,9.83-14.49,35.86,35.86,0,0,0-.94-17.77,51,51,0,0,0-23.51-29.9c-1.55-.89-3.15-1.69-4.75-2.49a9.59,9.59,0,0,0,8-13.59,6.47,6.47,0,0,0-3.43-3.47c-2.62-1-5.63.58-7.24,2.86s-2.13,5.14-2.61,7.89a14.58,14.58,0,0,0-7.93-12.57,3.71,3.71,0,0,0-3.14-.38,3.63,3.63,0,0,0-1.65,2.5,12.82,12.82,0,0,0,3.16,12Z" fill="#fff"/>
                        <path id="Path_15" data-name="Path 15" d="M156.65,104.32c-6.09-1.35-12,2.9-16.28,7.4a78.92,78.92,0,0,0-20.47,39.36c-.92,4.72-1.39,9.71.21,14.24a10.88,10.88,0,0,0,2.9,4.58c2.16,1.93,5.14,2.57,8,3.14l13.23,2.66c5.69,1.14,11.43,2.29,17.24,2.22,5.56-.06,11-1.24,16.47-2.43,4.14-.91,8.37-1.87,12-4.1,5.1-3.14,8.5-8.64,9.83-14.49a36.1,36.1,0,0,0-.94-17.77,51.08,51.08,0,0,0-23.51-29.9c-1.56-.88-3.16-1.68-4.75-2.49a9.59,9.59,0,0,0,8-13.59,6.44,6.44,0,0,0-3.43-3.47c-2.62-1-5.63.58-7.23,2.87s-2.13,5.13-2.62,7.88a14.54,14.54,0,0,0-7.93-12.56,3.67,3.67,0,0,0-3.14-.38A3.63,3.63,0,0,0,152.55,90a12.84,12.84,0,0,0,3.16,12Z" fill="#29abe2"/>
                        <path id="Path_16" data-name="Path 16" d="M160.86,102.73c-7.88-1.59-14.53,4.16-19.43,9.6a80,80,0,0,0-12.71,18.92,76,76,0,0,0-7,22.19c-1.06,7.52-.09,16.69,8,19.71a34.842,34.842,0,0,0,5.61,1.39l6.86,1.38c4.48.9,9,1.88,13.49,2.57a54.12,54.12,0,0,0,13.33.58,107.109,107.109,0,0,0,13.08-2.28c4-.88,8-1.81,11.58-3.8a22.31,22.31,0,0,0,7.62-7.22c4.46-6.74,5.16-15.12,3.72-22.91a52.21,52.21,0,0,0-24.22-34.49c-1.86-1.12-3.8-2.09-5.74-3.07l-.76,2.8a11.34,11.34,0,0,0,9.24-6.15,11.09,11.09,0,0,0-.86-11.24,7,7,0,0,0-9.68-1.64c-3.68,2.41-4.7,6.75-5.42,10.82l3,.4a16.29,16.29,0,0,0-4.25-10.5c-2.18-2.39-7.05-6.09-10.05-3-1.32,1.35-1.66,3.49-1.79,5.29a14.23,14.23,0,0,0,.8,5.64,11.72,11.72,0,0,0,2.91,4.87c-.21-.17-.18-.49,0,0,.12.27.22.54.33.81l.46,1.19c.71,1.77,3.61,1,2.9-.8-.27-.67-.53-1.33-.79-2a20.4,20.4,0,0,0-1.9-2.79,11.3,11.3,0,0,1-1.39-8.72c.15-.57.36-1.38,1-1.59s1.7.39,2.27.72a12.64,12.64,0,0,1,3.4,2.82,13.06,13.06,0,0,1,3.13,8.1c0,1.61,2.64,2.13,2.94.4.51-2.87,1-6.22,3.19-8.34,2-1.93,4.9-2.23,6.64.16,3.62,5-.15,12-6,12.59-1.34.13-2.21,2.07-.75,2.8a55.3,55.3,0,0,1,16.75,12.15,49.45,49.45,0,0,1,10,16.61c2.49,7.09,3.54,15,1.08,22.28a21.94,21.94,0,0,1-5,8.28,21.12,21.12,0,0,1-9.25,5.25,116.393,116.393,0,0,1-11.38,2.6,56.42,56.42,0,0,1-12.16,1.19c-8.39-.23-16.75-2.47-25-4.12-3.36-.67-7.44-1-10.29-3.07s-3.82-6.2-4-9.59a42,42,0,0,1,1.47-11.37,77.74,77.74,0,0,1,13.48-28.55,67.067,67.067,0,0,1,6.92-7.94c2.49-2.42,5.39-4.71,8.77-5.72a10.26,10.26,0,0,1,5-.27C162,106,162.75,103.12,160.86,102.73Z" fill="#1a1a1a"/>
                        <path id="Path_17" data-name="Path 17" d="M234.3,118.43c-4.4-1-8.65,2.1-11.78,5.35a57.15,57.15,0,0,0-14.8,28.48c-.67,3.41-1,7,.15,10.3a8,8,0,0,0,2.09,3.31c1.57,1.4,3.73,1.86,5.78,2.27l9.58,1.92a59.761,59.761,0,0,0,12.47,1.61,59.47,59.47,0,0,0,11.91-1.76,27.48,27.48,0,0,0,8.67-3,16.59,16.59,0,0,0,7.11-10.48,26,26,0,0,0-.68-12.86,37,37,0,0,0-17-21.63c-1.12-.64-2.28-1.22-3.44-1.8a6.94,6.94,0,0,0,5.8-9.83,4.69,4.69,0,0,0-2.48-2.51c-1.9-.7-4.08.42-5.24,2.07a14,14,0,0,0-1.89,5.71,10.52,10.52,0,0,0-5.74-9.09,2.11,2.11,0,0,0-3.46,1.53,9.29,9.29,0,0,0,2.29,8.66Z" fill="#fff"/>
                        <path id="Path_18" data-name="Path 18" d="M229.38,118.25c-4.41-1-8.65,2.09-11.78,5.35a57.13,57.13,0,0,0-14.81,28.47c-.67,3.41-1,7,.15,10.3a8,8,0,0,0,2.1,3.32c1.56,1.39,3.72,1.86,5.78,2.27l9.57,1.92a60.52,60.52,0,0,0,12.47,1.61,58.879,58.879,0,0,0,11.92-1.77,27.26,27.26,0,0,0,8.66-3,16.54,16.54,0,0,0,7.11-10.48,26,26,0,0,0-.68-12.85,36.88,36.88,0,0,0-17-21.63c-1.12-.64-2.28-1.22-3.43-1.8a6.94,6.94,0,0,0,5.79-9.84,4.67,4.67,0,0,0-2.48-2.5c-1.9-.7-4.08.42-5.24,2.07a13.89,13.89,0,0,0-1.89,5.7,10.51,10.51,0,0,0-5.73-9.09,2.69,2.69,0,0,0-2.28-.27,2.61,2.61,0,0,0-1.19,1.8,9.28,9.28,0,0,0,2.29,8.66Z" fill="#29abe2"/>
                        <path id="Path_19" data-name="Path 19" d="M234.53,116.7c-5.83-1.14-10.69,2.89-14.36,6.94a58.54,58.54,0,0,0-9.38,13.93,55.55,55.55,0,0,0-5.07,16.25c-.78,5.59.05,12.3,6,14.58,2.82,1.08,6,1.41,9,2,3.26.66,6.51,1.37,9.79,1.88a40.151,40.151,0,0,0,9.79.46,77.245,77.245,0,0,0,9.67-1.67,31.82,31.82,0,0,0,8.26-2.68,16.44,16.44,0,0,0,5.88-5.48c3.27-4.95,3.79-11.09,2.75-16.81a37.47,37.47,0,0,0-7.55-16.3,41.27,41.27,0,0,0-14.33-11.2l-.76,2.79a8.63,8.63,0,0,0,7-4.66,8.41,8.41,0,0,0-.72-8.66,5.43,5.43,0,0,0-7.45-1.23c-2.78,1.78-3.59,5-4.13,8.09l3,.4a12.27,12.27,0,0,0-3.28-8c-1.71-1.84-5.33-4.42-7.68-2.18-2,1.91-1.79,5.76-1,8.16a10.09,10.09,0,0,0,2.23,3.89c-.11-.11-.22-.57,0-.12.07.15.13.32.19.48l.39,1c.7,1.78,3.6,1,2.89-.8l-.54-1.35a8.93,8.93,0,0,0-1.24-1.87,7.87,7.87,0,0,1-1.28-6c.25-1.16.57-1.41,1.68-.83a8.64,8.64,0,0,1,2.39,1.91,9,9,0,0,1,2.28,5.72c0,1.61,2.63,2.13,2.94.4.34-1.9.64-4.1,2-5.6s3.14-1.84,4.37-.26c2.54,3.29,0,8.12-4,8.52-1.34.14-2.22,2.07-.76,2.8a39.64,39.64,0,0,1,12,8.7,35.16,35.16,0,0,1,7.05,11.66c1.81,5,2.62,10.7.92,15.89a14.62,14.62,0,0,1-10,9.67,79.522,79.522,0,0,1-8.05,1.86,40.759,40.759,0,0,1-8.95.9c-5.91-.16-11.78-1.73-17.56-2.89-2.38-.47-5.25-.68-7.35-2-2.27-1.42-3-4.41-3-6.91-.18-5.11,1.46-10.46,3.28-15.19a54.929,54.929,0,0,1,8.42-14.62c3.11-3.86,7.95-9.77,13.58-8.67C235.62,120,236.43,117.06,234.53,116.7Z" fill="#1a1a1a"/>
                      </g>
                    </svg> :
                      <svg 
                      xmlns="http://www.w3.org/2000/svg" 
                      viewBox="0 0 103.467 102.781"
                      style={{
                        width: `${50 + (pointCount / points.length) * 20}px`,
                        height: `${50 + (pointCount / points.length) * 20}px`,
                      }}
                      onClick={() => {
                        const expansionZoom = Math.min(
                          supercluster.getClusterExpansionZoom(cluster.id),
                          30
                        )
  
                        setShowInfo(false)
  
                        setViewport({
                          ...viewport,
                          latitude,
                          longitude,
                          zoom: expansionZoom,
                          transitionInterpolator: new FlyToInterpolator({
                            speed: 1
                          }),
                          transitionDuration: "auto"
                        })
                      }}
                      >
                        <g id="afval_1" transform="translate(-11.266 -5.268)">
                          <path id="Path_1" data-name="Path 1" d="M36.8,21.881c3.378-1.772,11.63-7.359,7.59-12.019C40.8,5.727,33.7,11.929,32.195,15.3a15.84,15.84,0,0,0-4.229-6.869c-1.5-1.282-5.144-2.681-5.753.207-.514,2.4,1.453,5.652,2.676,7.56,1.128,1.772,2.835,5.02,5,5.623l-.514.591A120.673,120.673,0,0,0,11.912,70.5c-.75,5.576-1.1,11.346.378,16.8a13.912,13.912,0,0,0,4.01,7.088A13.8,13.8,0,0,0,20.919,96.9a24.139,24.139,0,0,0,11.695,1.028c7.731-1.246,14.766-6.237,22.574-6.042a28.878,28.878,0,0,0,4.684.065,11.815,11.815,0,0,0,6.656-3.916c5.641-5.971,7.678-14.766,6.769-22.9S68.873,49.3,64.627,42.27c-3.024-5.02-6.5-9.858-11-13.614s-10.147-6.367-16.006-6.408" transform="translate(0 -0.683)" fill="#29abe2"/>
                          <path id="Path_2" data-name="Path 2" d="M42.741,21.836A27.293,27.293,0,0,0,48.169,18.1c1.683-1.5,3.39-3.455,3.65-5.782a5.139,5.139,0,0,0-3.337-5.245c-2.162-.768-4.572.23-6.379,1.418a14.419,14.419,0,0,0-5.186,5.57l1.618.213a16.905,16.905,0,0,0-4.194-7.023,6.726,6.726,0,0,0-4.95-1.961c-2.363.254-2.9,2.664-2.528,4.666.443,2.363,1.855,4.448,3.1,6.5s2.693,4.69,5.168,5.458l-.39-1.477a27.419,27.419,0,0,0-2.292,3.479c-.933,1.571-1.831,3.172-2.693,4.784q-2.622,4.9-4.772,10.041A121.618,121.618,0,0,0,18.23,60q-1.181,5.387-1.861,10.868a48.06,48.06,0,0,0-.23,11.866c.437,3.461,1.347,7.088,3.5,9.887s5.652,4.341,9.114,5.121a25.545,25.545,0,0,0,11.287-.053,96.919,96.919,0,0,0,9.905-3.4c3.278-1.181,6.7-2.321,10.242-2.327a32.193,32.193,0,0,0,5.646,0,10.631,10.631,0,0,0,4.489-2.044c5.316-3.963,8.31-10.631,9.214-17.081a40.772,40.772,0,0,0-3.065-20.85A75.927,75.927,0,0,0,65.4,33.059c-4.418-5.5-10.212-10.165-17.17-11.854a23.035,23.035,0,0,0-5.109-.65.886.886,0,1,0,0,1.772c14.417.195,23.844,14.128,29.615,25.681C75.823,54.186,78.085,61,78.109,67.942c0,6.255-1.731,12.758-5.794,17.625-2.044,2.451-4.725,4.7-8.044,4.784-1.813.047-3.609-.242-5.428-.106a25.675,25.675,0,0,0-4.908.868c-6.562,1.772-12.622,5.416-19.586,5.434a21.168,21.168,0,0,1-10.271-2.428c-2.989-1.683-4.589-4.666-5.452-7.885-1.92-7.123-.774-14.831.543-21.96a120.237,120.237,0,0,1,14.813-39.52A24.217,24.217,0,0,1,36,21.647a.9.9,0,0,0-.39-1.482c-1.672-.52-2.752-2.457-3.621-3.845a36.166,36.166,0,0,1-2.829-4.961c-.408-.963-1.423-3.78.148-4.27,1.134-.354,2.67.473,3.544,1.181a14.42,14.42,0,0,1,4,6.5c.224.65,1.276.957,1.624.213a12.215,12.215,0,0,1,3.544-4.229c1.406-1.122,3.355-2.363,5.239-2.126a3.319,3.319,0,0,1,2.811,3.5c-.183,1.855-1.713,3.438-3.018,4.625a25.5,25.5,0,0,1-5.209,3.6c-1.01.537-.112,2.067.9,1.53Z" transform="translate(-1.888 0)" fill="#1a1a1a"/>
                          <path id="Path_3" data-name="Path 3" d="M139.22,89.891A63.672,63.672,0,0,0,129.345,73.1a33.973,33.973,0,0,0-15.971-10.826l-.348-.354a8.923,8.923,0,0,0,4.725-.762c1.388-.809,2.286-2.758,1.382-4.134-.768-1.146-2.363-1.329-3.756-1.24-1.961.124-4.194.8-4.908,2.634a21.452,21.452,0,0,0-1.589-4.725,7.158,7.158,0,0,0-3.473-3.42,2.953,2.953,0,0,0-1.955-.195c-1.506.455-1.961,2.451-1.553,3.969a12.48,12.48,0,0,0,2.469,4.223q1.648,2.109,3.29,4.229l-.39.555a3.432,3.432,0,0,0-1.27-.083,3.028,3.028,0,0,1-2.93,2.971H102.8l-.3.065a3.166,3.166,0,0,1-.827.4c.413-.13-.638,1.116-.809,1.347-.626.821-1.282,1.612-1.967,2.363C97.5,71.7,96,73.211,94.609,74.806a2.469,2.469,0,0,1-2.457.9c-.419.591-.827,1.181-1.217,1.837a28.894,28.894,0,0,0-3.39,7.088,30.843,30.843,0,0,0-1.028,9.013c0,3.987.449,8.08,2.3,11.612a8.841,8.841,0,0,0,5.316,4.725c2.073.484,4.223-.171,6.284-.7a39.738,39.738,0,0,1,13.071-1.335c6.869.555,13.756,3.39,20.454,1.772a10.72,10.72,0,0,0,4.3-2c2.487-2.026,3.544-5.41,3.438-8.612A26.259,26.259,0,0,0,139.22,89.891Z" transform="translate(-30.798 -18.31)" fill="#29abe2"/>
                          <path id="Path_4" data-name="Path 4" d="M112.633,59.967c-1.4-1.8-2.882-3.544-4.188-5.44-.921-1.311-2.02-3.2-1.181-4.814.992-1.872,3.491.148,4.323,1.181a15.09,15.09,0,0,1,2.363,5.836c.171.673,1.311.933,1.618.213a3.793,3.793,0,0,1,2.983-2.044c1.134-.236,2.788-.419,3.792.3s.52,2.256-.331,2.953c-1.234,1.051-3.148.933-4.66.9a.9.9,0,0,0-.632,1.512,2.415,2.415,0,0,0,.638.537,16.169,16.169,0,0,0,1.689.561,28.718,28.718,0,0,1,3.272,1.429,32.875,32.875,0,0,1,5.954,3.951,44.634,44.634,0,0,1,9.6,11.506,73.033,73.033,0,0,1,3.627,6.94,50.392,50.392,0,0,1,2.953,7.572c1.234,4.465.963,10.23-3.544,12.764-4.725,2.652-10.767,1.347-15.782.378a59.688,59.688,0,0,0-8.121-1.181,38.393,38.393,0,0,0-8.346.543q-2.073.354-4.134.88a20.288,20.288,0,0,1-4.134.833,6.623,6.623,0,0,1-5.8-3.278c-2.894-4.312-3.065-10.07-2.817-15.085a24.057,24.057,0,0,1,1.642-7.991,36.212,36.212,0,0,1,3.869-6.8,50.825,50.825,0,0,1,4.837-5.954,35.521,35.521,0,0,1,5.711-5.127,4.638,4.638,0,0,1,3.544-1.028c1.11.254,1.589-1.459.473-1.707-2.835-.632-5.2,1.282-7.2,3.024a52.6,52.6,0,0,0-5.729,5.8c-3.544,4.134-6.893,9.031-8.186,14.4a34.7,34.7,0,0,0-.756,8.682,30.855,30.855,0,0,0,1.075,8.216,14.175,14.175,0,0,0,3.851,6.615,8.213,8.213,0,0,0,7.395,1.772c1.471-.278,2.9-.726,4.365-1.051a42.6,42.6,0,0,1,4.471-.768,34.771,34.771,0,0,1,8.93.106c5.729.833,11.452,2.705,17.288,1.772a11.35,11.35,0,0,0,6.987-3.544,11.736,11.736,0,0,0,2.552-6.58,19.676,19.676,0,0,0-1.364-8.216,75.608,75.608,0,0,0-3.361-7.785c-4.66-9.5-11.63-18.4-21.73-22.415-.591-.236-1.181-.449-1.772-.644l-.455-.142s.242.2.106.1a2.327,2.327,0,0,1-.289-.3l-.626,1.518c2.1.041,4.566,0,6.131-1.63,1.294-1.347,1.772-3.591.372-5.05s-3.609-1.347-5.375-1.057-3.691,1.181-4.442,2.953l1.618.213c-.644-2.546-1.376-5.192-3.266-7.123-1.536-1.565-4.465-2.953-6.225-.927-1.547,1.772-.98,4.329.065,6.178a28.583,28.583,0,0,0,2.363,3.272l2.77,3.544c.7.9,1.949-.366,1.252-1.252Z" transform="translate(-32.212 -17.181)" fill="#1a1a1a"/>
                          <path id="Path_5" data-name="Path 5" d="M80.868,97.609c-3.6-.8-7.088,1.713-9.622,4.365a46.725,46.725,0,0,0-12.09,23.253c-.543,2.788-.821,5.735.13,8.411a6.45,6.45,0,0,0,1.707,2.705,9.746,9.746,0,0,0,4.725,1.855l7.808,1.595A49.532,49.532,0,0,0,83.709,141.1a48.807,48.807,0,0,0,9.728-1.441,22.634,22.634,0,0,0,7.088-2.416,13.549,13.549,0,0,0,5.806-8.558,21.18,21.18,0,0,0-.555-10.5,30.123,30.123,0,0,0-13.886-17.66c-.916-.526-1.861-1-2.806-1.471a5.67,5.67,0,0,0,4.725-8.027,3.821,3.821,0,0,0-2.026-2.05,3.861,3.861,0,0,0-4.276,1.689,11.457,11.457,0,0,0-1.547,4.66A8.594,8.594,0,0,0,81.3,87.887a2.2,2.2,0,0,0-1.861-.224,2.162,2.162,0,0,0-.975,1.477,7.572,7.572,0,0,0,1.872,7.088Z" transform="translate(-19.401 -33.684)" fill="#fff"/>
                          <path id="Path_6" data-name="Path 6" d="M76.82,97.352c-3.6-.8-7.088,1.713-9.616,4.371a46.613,46.613,0,0,0-12.09,23.248,16.047,16.047,0,0,0,.124,8.411,6.5,6.5,0,0,0,1.707,2.705,9.745,9.745,0,0,0,4.725,1.855l7.82,1.571a49.075,49.075,0,0,0,10.177,1.311,48.491,48.491,0,0,0,9.734-1.435,22.548,22.548,0,0,0,7.088-2.422,13.475,13.475,0,0,0,5.806-8.558,21.186,21.186,0,0,0-.555-10.5,30.123,30.123,0,0,0-13.886-17.66c-.915-.52-1.861-.992-2.806-1.471a5.664,5.664,0,0,0,4.725-8.027,3.43,3.43,0,0,0-6.3-.354,11.279,11.279,0,0,0-1.542,4.654,8.6,8.6,0,0,0-4.7-7.418,2.174,2.174,0,0,0-1.855-.224,2.144,2.144,0,0,0-.975,1.482,7.566,7.566,0,0,0,1.866,7.088Z" transform="translate(-17.745 -33.58)" fill="#29abe2"/>
                          <path id="Path_7" data-name="Path 7" d="M80.252,95.723c-4.654-.939-8.582,2.457-11.476,5.67a47.252,47.252,0,0,0-7.507,11.175,44.888,44.888,0,0,0-4.134,13.106c-.632,4.442-.053,9.858,4.725,11.641a20.67,20.67,0,0,0,3.308.821l4.058.815c2.646.532,5.316,1.11,7.962,1.518a32.012,32.012,0,0,0,7.879.343,63.655,63.655,0,0,0,7.726-1.347,24.693,24.693,0,0,0,6.834-2.244,13.142,13.142,0,0,0,4.507-4.264c2.634-3.981,3.048-8.93,2.2-13.532A30.837,30.837,0,0,0,92.023,99.054c-1.1-.662-2.244-1.234-3.39-1.813l-.449,1.654a6.7,6.7,0,0,0,5.457-3.632,6.58,6.58,0,0,0-.508-6.639,4.134,4.134,0,0,0-5.723-.969c-2.168,1.423-2.77,3.987-3.2,6.391l1.736.236a9.562,9.562,0,0,0-2.51-6.2c-1.282-1.412-4.134-3.6-5.906-1.772a4.935,4.935,0,0,0-1.057,3.124,8.4,8.4,0,0,0,.473,3.331,6.922,6.922,0,0,0,1.719,2.876c-.124-.1-.112-.289,0,0,.065.159.13.319.189.478l.278.7c.419,1.045,2.132.591,1.707-.473-.154-.4-.307-.786-.467-1.181A11.1,11.1,0,0,0,79.26,93.52a6.7,6.7,0,0,1-.815-5.15c.089-.337.213-.815.591-.939s1,.23,1.341.425a7.56,7.56,0,0,1,2.008,1.666,7.678,7.678,0,0,1,1.843,4.784c.03.951,1.559,1.258,1.772.236.3-1.7.591-3.674,1.884-4.926,1.181-1.14,2.894-1.317,3.922.095,2.138,2.953-.095,7.088-3.544,7.436-.791.077-1.305,1.223-.449,1.654a32.663,32.663,0,0,1,9.893,7.176,29.012,29.012,0,0,1,5.877,9.811c1.477,4.188,2.1,8.86.644,13.159a12.994,12.994,0,0,1-2.953,4.89,12.445,12.445,0,0,1-5.463,3.1,68.255,68.255,0,0,1-6.716,1.536,33.361,33.361,0,0,1-7.182.7c-4.961-.136-9.893-1.459-14.766-2.433-1.99-.4-4.394-.591-6.084-1.813s-2.256-3.662-2.363-5.664a24.807,24.807,0,0,1,.868-6.716,45.627,45.627,0,0,1,7.962-16.863A39.614,39.614,0,0,1,71.617,101a13.131,13.131,0,0,1,5.18-3.378,6.054,6.054,0,0,1,2.953-.159C80.89,97.654,81.368,95.953,80.252,95.723Z" transform="translate(-18.691 -32.89)" fill="#1a1a1a"/>
                        </g>
                      </svg>

}
                    
                  </Marker>
                )
              }

              return (
                <Marker
                  key={`data-${cluster.properties.trashId}`}
                  latitude={latitude}
                  longitude={longitude}
                >
                  <svg width={10} height={10}>
                    <circle r={2.5} transform='translate(5, 5)' fill='#31A3DD'></circle>
                  </svg>
                </Marker>
              )
            })}
            
            { showInfo ? <MapInfo /> : null}
          </ReactMapGL>
        </>
      );
}